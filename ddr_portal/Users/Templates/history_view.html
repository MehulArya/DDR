{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ file.file_name }} - Preview</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; background: #f5f7fa; color: #333; }
        h1 { color: #4b6cb7; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f0f0f0; }
        a { text-decoration: none; color: #0066cc; }
        iframe { width: 100%; height: 90vh; border: none; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>{{ file.file_name }}</h1>
    <a href="{% url 'history_index' %}">⬅️ Back to Dashboard</a>

    <h2>Preview</h2>

    {% if message %}
        <p style="color: orange;">{{ message }}</p>
    {% endif %}

    {# ✅ CSV & Excel Preview as Table #}
    {% if file_type == "csv" or file_type == "xlsx" %}
        <table>
            {% for row in rows %}
            <tr>
                {% for col in row %}
                <td>{{ col }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>

    {# ✅ Word, Excel, PPT → Office Online Viewer #}
    {% elif file.file_name|lower|endswith:".docx" or
            file.file_name|lower|endswith:".doc" or
            file.file_name|lower|endswith:".xls" or
            file.file_name|lower|endswith:".xlsx" or
            file.file_name|lower|endswith:".ppt" or
            file.file_name|lower|endswith:".pptx" %}
        
        <iframe src="https://view.officeapps.live.com/op/embed.aspx?src={{ request.build_absolute_uri|slice:":-1" }}{% url 'serve_file' file.id %}"></iframe>

   
    {% elif file_type == 'pdf' %}
    <iframe src="{% url 'serve_file' file.id %}" width="100%" height="600px"></iframe>
    {# ✅ PDF, PNG, JPG → Inline Browser Preview #}
    {% else %}
        <iframe src="{% url 'serve_file' file.id %}"></iframe>
    {% endif %}
</body>
</html>
