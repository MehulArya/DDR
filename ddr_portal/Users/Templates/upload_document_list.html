<h2>Documents in Folder: {{ folder.folder_name }}</h2>

<ul>
  {% for doc in documents %}
    <li>
      üìÑ {{ doc.title }}

      <!-- Upload Button -->
      <button onclick="triggerUpload('{{ doc.id }}')">Upload File</button>

      <!-- Hidden File Input -->
      <input type="file" id="fileInput-{{ doc.id }}" style="display: none;" onchange="uploadFile('{{ folder.id }}', '{{ doc.id }}')">
    </li>
  {% empty %}
    <li>No documents found in this folder.</li>
  {% endfor %}
</ul>

<a href="{% url 'upload_folder_list' %}">üîô Back to Folder List</a>

<!-- JavaScript Section -->
<script>
  function triggerUpload(docId) {
    document.getElementById('fileInput-' + docId).click();
  }

  function uploadFile(folderId, documentId) {
    const input = document.getElementById('fileInput-' + documentId);
    const file = input.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append('file', file);
    formData.append('folder_id', folderId);
    formData.append('document_id', documentId);
    formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));

    fetch("{% url 'ajax_upload_file' %}", {
      method: 'POST',
      body: formData,
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('‚úÖ Upload successful!');
        location.reload();  // refresh to see new data
      } else {
        alert('‚ùå Upload failed: ' + data.error);
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('‚ùå Upload error');
    });
  }

  // CSRF token fetcher
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.startsWith(name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
