{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>History Files</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <style>
        /* Slider button styling */
        .toggle-container {
            position: absolute;
            top: 20px;
            right: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0;
            right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4CAF50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
<h1>File History</h1>

<!-- Toggle Switch -->
<div class="toggle-container">
    <span>Active</span>
    <label class="switch">
        <input type="checkbox" id="toggleDeleted">
        <span class="slider"></span>
    </label>
    <span>Deleted</span>
</div>

<table id="historyTable" class="display">
    <thead>
        <tr>
            <th>File Name</th>
            <th>Uploaded By</th>
            <th>Upload Time</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for f in files %}
        <tr data-status="{{ f.is_deleted|yesno:'deleted,active' }}">
            <td>{{ f.file_name }}</td>
            <td>{{ f.uploaded_by }}</td>
            <td>{{ f.upload_time }}</td>
           <td>
    {% if not f.is_deleted %}
        <!-- Active file actions -->
        <a href="{% url 'history_view_file' f.id %}">View</a> |
{% if f.file_name|lower|slice:"-4:" == ".csv" or f.file_name|lower|slice:"-5:" == ".xlsx" or f.file_name|lower|slice:"-5:" == ".docx" or f.file_name|lower|slice:"-4:" == ".doc"%}
    <a href="{% url 'history_edit_file' f.id %}">Edit</a> |
{% endif %}
        <a href="{% url 'history_download_file' f.id %}">Download</a> |
        <a href="{% url 'history_delete_file' f.id %}" onclick="return confirm('Delete this file?');">Delete</a>
    {% else %}
        <!-- Deleted file actions -->
        <a href="{% url 'history_restore_file' f.id %}" onclick="return confirm('Restore this file?');">Restore</a>
    {% endif %}
</td>

        </tr>
    {% endfor %}
    </tbody>
</table>

<script>
$(document).ready(function() {
    var table = $('#historyTable').DataTable();

    // Toggle switch for Active / Deleted
    $('#toggleDeleted').on('change', function() {
        if ($(this).is(':checked')) {
            // Show only deleted files
            table.rows().every(function() {
                var status = $(this.node()).data('status');
                if (status === 'deleted') {
                    $(this.node()).show();
                } else {
                    $(this.node()).hide();
                }
            });
        } else {
            // Show only active files
            table.rows().every(function() {
                var status = $(this.node()).data('status');
                if (status === 'active') {
                    $(this.node()).show();
                } else {
                    $(this.node()).hide();
                }
            });
        }
    });

    // Default â†’ show active only
    $('#toggleDeleted').prop('checked', false).trigger('change');
});
</script>
</body>
</html>
